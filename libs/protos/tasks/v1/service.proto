syntax = "proto3";

package tasks;

import "tasks/v1/models.proto";
import "google/protobuf/timestamp.proto";
import "google/protobuf/struct.proto";
import "google/protobuf/empty.proto";
import "google/protobuf/field_mask.proto";

option go_package = "github.com/Kaptoshka/creative-learning-platform/libs/gen/go/tasks/v1;tasksv1";

service Tasks {
    // CRUD workflow with assignments
    rpc CreateAssignment(CreateAssignmentRequest) returns (CreateAssignmentResponse);
    rpc ListAssignments(ListAssignmentsRequest) returns (ListAssignmentsResponse);
    rpc UpdateAssignment(UpdateAssignmentRequest) returns (google.protobuf.Empty);
    rpc DeleteAssignment(DeleteAssignmentRequest) returns (google.protobuf.Empty);

    // Workflow of student with assignment
    rpc GetStudentAssignment(GetStudentAssignmentRequest) returns (GetStudentAssignmentResponse);
    rpc StartAssignment(StartAssignmentRequest) returns (StartAssignmentResponse);
    rpc SubmitAssignment(SubmitAssignmentRequest) returns (SubmitAssignmentResponse);
    rpc UpdateSubmission(UpdateSubmissionRequest) returns (google.protobuf.Empty);
    rpc DeleteSubmission(DeleteSubmissionRequest) returns (google.protobuf.Empty);

    // Workflow of teacher with assignments/submissions
    rpc GetTeacherAssignment(GetTeacherAssignmentRequest) returns (GetTeacherAssignmentResponse);
    rpc ProvideFeedback(ProvideFeedbackRequest) returns (google.protobuf.Empty);
    rpc ReturnSubmission(ReturnSubmissionRequest) returns (google.protobuf.Empty);
}

message CreateAssignmentRequest {
    string id = 1;
    string title = 2;
    AssignmentWidget widget = 3;
    google.protobuf.Timestamp due_date = 4;
}

message CreateAssignmentResponse {
    string id = 1;
}

message ListAssignmentsRequest {
    int32 page_size = 1;
    string pate_token = 2;
}

message ListAssignmentsResponse {
    repeated StudentAssignmentItem items = 1;
    string next_page_token = 2;
}

message GetTeacherAssignmentRequest {
    string id = 1;
}

message GetTeacherAssignmentResponse {
    Assignment assignment = 1;
}

message UpdateAssignmentRequest {
    string id = 1;
    string title = 2;
    AssignmentWidget widget = 3;
    google.protobuf.Timestamp due_date = 4;
}

message DeleteAssignmentRequest {
    string id = 1;
}

message GetStudentAssignmentRequest {
    string id = 1;
}

message GetStudentAssignmentResponse {
    StudentAssignment assignment = 1;
}

message StartAssignmentRequest {
    string id = 1;
}

message StartAssignmentResponse {
    string id = 1;
}

message SubmitAssignmentRequest {
    string id = 1;
    string assignment_id = 2;
    SubmissionStatus status = 3;
    google.protobuf.Struct payload = 4;
}

message SubmitAssignmentResponse {
    string id = 1;
}

message UpdateSubmissionRequest {
    string submission_id = 1;
    google.protobuf.Struct payload = 4;
}

message DeleteSubmissionRequest {
    string submission_version_id = 1;
}

message ProvideFeedbackRequest {
    string id = 1;
    string feedback = 2;
}

message ReturnSubmissionRequest {
    string submission_version_id = 1;
    SubmissionStatus status = 2;
    string feedback = 3;
}
