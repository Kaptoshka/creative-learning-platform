syntax = "proto3";

package tasks;

import "google/protobuf/descriptor.proto";
import "google/protobuf/duration.proto";
import "google/protobuf/struct.proto";
import "google/protobuf/timestamp.proto";

option go_package = "github.com/Kaptoshka/creative-learning-platform/libs/gen/go/tasks/v1;tasksv1";

// --- Enums ---

enum SubmissionStatus {
  SUBMISSION_STATUS_UNSPECIFIED = 0;
  SUBMISSION_STATUS_NOT_STARTED = 1;
  SUBMISSION_STATUS_IN_PROGRESS = 2;
  SUBMISSION_STATUS_SUBMITTED = 3;
  SUBMISSION_STATUS_GRADED = 4;
  SUBMISSION_STATUS_RETURNED = 5;
}

// --- Domain Models ---

message Widget {
  string id = 1;
  string type = 2;
  int32 version = 3;

  google.protobuf.Struct config_schema = 4;
  google.protobuf.Struct submission_schema = 5;
}

message AssignmentTemplate {
  string id = 1;
  string creator_id = 2;
  string title = 3;
  string description = 4;

  string widget_id = 5;
  google.protobuf.Struct widget_config = 6;

  google.protobuf.Timestamp due_date = 7;
  google.protobuf.Timestamp cutoff_date = 8;

  google.protobuf.Timestamp created_at = 9;
  google.protobuf.Timestamp updated_at = 10;
}

message AssignmentTemplateLight {
  string id = 1;
  string title = 2;
  string widget_type = 3;
  google.protobuf.Timestamp due_date = 4;
}

message AssignmentTarget {
  oneof target {
    string group_id = 1;
    string student_id = 2;
  }
}

message Submission {
  string id = 1;
  string template_id = 2;
  string student_id = 3;

  SubmissionStatus status = 4;

  google.protobuf.Timestamp started_at = 5;
  google.protobuf.Timestamp submitted_at = 6;
  SubmissionVersion latest_version = 7;
}

message SubmissionVersion {
  string id = 1;
  int32 version_number = 2;

  google.protobuf.Struct payload = 3;

  google.protobuf.Duration time_spent_seconds = 4;

  bool is_autosave = 5;
  google.protobuf.Timestamp created_at = 6;
}

message Feedback {
  string id = 1;
  string version_id = 2;
  string grader_id = 3;

  string text_content = 4;
  google.protobuf.Struct payload = 5;

  bool is_published = 6;
  google.protobuf.Timestamp created_at = 7;
}
